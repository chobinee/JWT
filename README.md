# JWT

> JWT(Json Web Token)μ— λ€ν•΄ μ•μ•„λ³΄μ.
>

# μ •μ

- μ •λ³΄λ¥Ό ***JSON*** κ°μ²΄λ΅ μ•μ „ν•κ² μ „μ†΅ν•κΈ° μ„ν•, κ°„κ²°ν•κ³  λ…λ¦½μ μΈ λ°©λ²•μ„ μ •μν•λ” κ°λ°©ν• ν‘μ¤€
- μ„ νƒμ  μ„λ… λ° μ„ νƒμ  μ•”νΈν™” μ‚¬μ©
- λΉ„λ°€(**HMAC**) νΉμ€ κ³µκ°/κ°μΈ ν‚¤(**RSA/ECDSA**) μ μ•κ³ λ¦¬μ¦μ„ μ‚¬μ©ν•μ—¬ μ„λ…

> JSON(JavaScript Object Notation) : μ†μ„±-κ°’ μ / μ‹λ¦¬μ–Όν™” κ°€λ¥ν• κ°’ μμΌλ΅ μ΄λ£¨μ–΄μ§„ λ°°μ—΄ μλ£ν•μΌλ΅ μΈν„°λ„·μ—μ„ μλ£λ¥Ό μ£Όκ³  λ°›μ„ λ• λ³€μ κ°’μ„ ν‘ν„ν•λ” λ° μ‚¬μ©
>
>
> HMAC(Hash-based Message Authentication Code) : λ©”μ‹μ§€ μΈμ¦ μ½”λ“λ¥Ό μƒμ„±ν•κΈ° μ„ν• μ•κ³ λ¦¬μ¦μΌλ΅, μ†΅μμ‹ μλ§ κ³µμ ν•κ³  μλ” ν‚¤μ™€ μ›λ³Έ λ©”μ‹μ§€λ¥Ό νΌν•©ν•μ—¬ ν•΄μ‹κ°’μ„ λ§λ“¤κ³  μ΄λ¥Ό λΉ„κµν•¨μΌλ΅μ¨ λ¬΄κ²°μ„±κ³Ό μ§„λ³Έ ν™•μΈμ„ λ™μ‹ μν–‰
>
> RSA : SSL, TLS λ“±μ— μ‚¬μ©λλ” κ³µκ°ν‚¤ μ•”νΈν™” μ•κ³ λ¦¬μ¦μΌλ΅, κ³µκ°ν‚¤μ™€ κ°μΈν‚¤κ°€ ν• μμ„ μ΄λ£¨λ©°
> κ³µκ°ν‚¤λ΅ μ•”νΈν™”ν• λ‚΄μ©μ€ κ°μΈν‚¤λ΅λ§, κ°μΈν‚¤λ΅ μ•”νΈν™”ν• λ‚΄μ©μ€ κ³µκ°ν‚¤λ΅λ§ ν•΄λ… κ°€λ¥
>

# μ©λ„

> JWTλ” μ–Έμ  μ‚¬μ©λ κΉ?
>

## Authorization

- μ‚¬μ©μκ°€ λ΅κ·ΈμΈν• λ’¤, JWTκ°€ ν¬ν•¨λμ–΄ ν•΄λ‹Ή ν† ν°μΌλ΅ ν—μ©λλ” κ²½λ΅, μ„λΉ„μ¤, λ¦¬μ†μ¤μ— μ•΅μ„Έμ¤ κ°€λ¥

## μ •λ³΄ κµν™

- μ„λ…μ„ ν†µν•΄ λ³΄λ‚Έ μ‚¬λμ΄ λ„κµ¬μΈμ§€ ν™•μΈ κ°€λ¥ν•λ©° ν—¤λ”μ™€ νμ΄λ΅λ“λ¥Ό μ‚¬μ©ν•΄ μ„λ…μ„ κ³„μ‚°ν•λ―€λ΅ λ³€μ΅° μ—¬λ¶€ ν™•μΈ κ°€λ¥

# κµ¬μ΅°

- μ (.)μΌλ΅ κµ¬λ¶„λ μ„Έ λ¶€λ¶„μΌλ΅ κµ¬μ„±
  - header
  - payload
  - signature
- μ„Έ λ¶€λ¶„μ€ Base64url μΈμ½”λ”©μ„ μ‚¬μ©ν•μ—¬ λ³„λ„λ΅ μΈμ½”λ”©λ¨

μΌλ°μ μΌλ΅ λ‹¤μκ³Ό κ°™μ

> xxxxx.yyyyy.zzzzz
>
- code ver.

```json
const token = base64urlEncoding(header) + '.' + base64urlEncoding(payload) + '.' + base64urlEncoding(signature)
```

## Header

- μ‚¬μ©λλ” μ„λ… μ•κ³ λ¦¬μ¦κ³Ό ν† ν° μ ν•μ λ‘ λ¶€λ¶„μΌλ΅ κµ¬μ„±

```json
    {
        "alg" : "HS256", //HMAC-SHA256μ„ μ‚¬μ©ν•μ—¬ μ„λ…λ¨
        "typ" : "JWT"
    }

```

> SHA(Secure Hash Algorithm) : μ•”νΈν™” ν•΄μ‹ μ•κ³ λ¦¬μ¦μΌλ΅, μμΈ΅λ ν•΄μ‹κ°’μ— λ€ν•΄ κ³„μ‚°λ ν•΄μ‹λ¥Ό λΉ„κµν•¨μΌλ΅μ¨ λ¬΄κ²°μ„±μ„ νμ•…
>

## payload

- λ€μƒ(μ‚¬μ©μ)μ— λ€ν• μ •λ³΄λ΅ name-value ν•μ‹
- claim : λ°μ΄ν„° κ°κ°μ key
  - registered
  - public
  - private

### registered claim

- **μ„Έ κΈ€μ**λ΅ μ •μν•λ©° ν•„μλ” μ•„λ‹μ§€λ§ κ¶μ¥λ ν΄λ μ„ μ§‘ν•©
  - iss(issuer) : ν† ν° λ°κΈ‰μ
  - exp(expiration time) : ν† ν° λ§λ£ μ‹κ°„
  - sub(subject) : ν† ν° μ λ©
  - aud(audience) : ν† ν° λ€μƒμ
  - nbf(not before) : ν† ν° ν™μ„± λ‚ μ§
  - iat(issued at) : ν† ν° λ°κΈ‰ μ‹κ°„
  - jti(jwt id) : ν† ν°μ κ³ μ  μ‹λ³„μ(issuer μ—¬λ¬ λ…μΌ λ• μ‚¬μ©)

```jsx
{
	"sub" : "1234567890",
	"name" : "Subin Cho",
	"iat" : 1572312351
}
```

### public claim

- μ‚¬μ©μκ°€ μμ λ΅­κ² μ •μν•  μ μλ” ν΄λ μ„
- μ¶©λ λ°©μ§€λ¥Ό μ„ν•΄ **IANA JSON Web Token Claims Registry**μ— μ •μλ μ΄λ¦„μ„ μ‚¬μ©ν•κ±°λ‚ URIλ΅ μ •μν•΄μ•Ό ν•¨
  - URIλ΅ μ •μν•λ” κ²½μ°

    ```jsx
    {
    	"https://uriuri.com/hello" : true
    }
    ```


### private claim

- λ“±λ΅λμ§€ μ•μ€ λΉ„κ³µκ° ν΄λ μ„μΌλ΅, μ •λ³΄ κ³µμ λ¥Ό μ„ν•΄ μ»¤μ¤ν„°λ§μ΄μ§•λ ν΄λ μ„
- ν΄λΌμ΄μ–ΈνΈ β†” μ„λ²„ ν‘μν•μ— μ‚¬μ©

```jsx
{
	"tokenType" : "accessToken",
	"username" : "sbcho",
	"usage" : "access"
}
```

<aside>
π’΅ payloadλ” μ„λ…λ ννΈκ°€ μ•„λ‹λΌ λ‹¨μ Base64 μΈμ½”λ”© λ ννΈμ΄κΈ° λ•λ¬Έμ— λ„κµ¬λ‚ λ””μ½”λ”©ν•μ—¬ λ°μ΄ν„° μ—΄λμ΄ κ°€λ¥ν•¨. λ°μ΄ν„° λ‹΄μ„ λ• μ£Όμ!

</aside>

## Signature

- λ©”μ‹μ§€μ **λ¬΄κ²°μ„± ν™•μΈ**μ— μ‚¬μ©
- κ°μΈ ν‚¤λ΅ μ„λ…λ κ²½μ° μ†΅μ‹ μ ν™•μΈ κ°€λ¥
1. Base64λ΅ μΈμ½”λ”© λ headerμ™€ payloadλ¥Ό `.` μΌλ΅ μ—°κ²°
2. λΉ„λ°€ ν‚¤λ¥Ό μ΄μ©ν•μ—¬ headerμ— μ •μλ μ•”νΈν™” μ•κ³ λ¦¬μ¦μΌλ΅ ν•΄μ‹±
3. ν•΄μ‹±λ κ°’μ„ λ‹¤μ‹ Base64λ΅ μΈμ½”λ”©

- HMAC SHA256 μ•κ³ λ¦¬μ¦μΌλ΅ μ„λ… μƒμ„±ν•  κ²½μ°

```jsx
HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  secret)
```

- JWT μμ‹

```jsx
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IlN1YmluIENobyIsImlhdCI6MTU3MjMxMjM1MX0.u3T6xovikuX2wSi6yXg6c4x4y_y88A5qer4ga3fEm_M
```

# μ ν¨μ„± κ²€μ¦

> μ„λ²„μ—μ„λ” μ–΄λ–»κ² ν† ν°μ„ κ²€μ¦ν• κΉ?
>
1. λ°›μ€ JWTλ¥Ό Header, Payload, Signatureλ΅ λ¶„λ¦¬
2. Headerμ—μ„ μ§€μ •λ μ•”νΈν™” μ•κ³ λ¦¬μ¦κ³Ό μ„λ²„μ— μ €μ¥λ λΉ„λ°€ ν‚¤λ¥Ό μ‚¬μ©ν•μ—¬ headerμ™€ payload ν•΄μ‹±
3. ν•΄μ‹±λ κ°’κ³Ό JWTμ—μ„ μ¶”μ¶ν• signature λΉ„κµ
  - μΌμΉν•λ©΄ κ²€μ¦ μ„±κ³µ, μΌμΉν•μ§€ μ•μΌλ©΄ κ²€μ¦ μ‹¤ν¨

# Work

- μ‚¬μ©μκ°€ μ„±κ³µμ μΌλ΅ λ΅κ·ΈμΈν•λ©΄ JWTκ°€ λ°ν™λ¨
- μκ²© μ¦λ…μ΄λ―€λ΅ ν•„μ”ν• λ§νΌλ§ λ³΄κ΄€ν•΄μ„ μ‚¬μ©
- μΌλ°μ μΌλ΅ Bearer schemaλ¥Ό μ‚¬μ©ν•μ—¬ Authorization headerμ— JWTλ¥Ό λ³΄λ‚΄μ„ μ‚¬μ©

    ```jsx
    Authorization: Bearer <token>
    ```


<aside>
π’΅ μ ν¨ κΈ°κ°„μ΄ λ‹¤λ¥Έ JWT 2κ°(Access Token, Refresh Token)λ¥Ό λ°κΈ‰

Access Token : headerμ— λ‹΄κ²¨ λ¦¬μ†μ¤ μ ‘κ·Ό κ°€λ¥, λ§λ£ μ‹κ°„μ΄ μ§§μ
Refresh Token : access token λ§λ£ μ‹ μƒλ΅μ΄ access token λ°κΈ‰

* refresh token λ§λ£ μ‹ μ¬λ΅κ·ΈμΈν•μ—¬ μ¬λ°κΈ‰!

</aside>

# μ¥λ‹¨μ 

## μ¥μ 

- λ°μ΄ν„° μ„λ³€μ΅° λ°©μ§€
- μΈμ¦μ— ν•„μ”ν• λ¨λ“  μ •λ³΄λ¥Ό κ°€μ§€κ³  μκΈ° λ•λ¬Έμ— λ³„λ„ μ €μ¥μ†κ°€ ν•„μ”ν•μ§€ μ•μ
- μ„Έμ…κ³Ό λ‹¤λ¥΄κ² μ„λ²„λ” statelessκ°€ λ¨ β†’ μ„λ²„ λ¶€ν• λ‚®μ•„μ§
- ν™•μ¥μ„±μ΄ μ°μν•¨
- λ¨λ°”μΌμ—μ„λ„ μ λ™μ‘ν•¨

## λ‹¨μ 

- μΏ ν‚¤/μ„Έμ…κ³Ό λ‹¤λ¥΄κ² ν† ν°μ κΈΈμ΄κ°€ κΈΈμ–΄, μΈμ¦ μ”μ²­μ΄ λ§μ•„μ§ μλ΅ λ„¤νΈμ›ν¬ λ¶€ν•λ„ μ‹¬ν•΄μ§
- payload μμ²΄ μ•”νΈν™”κ°€ λμ§€ μ•κΈ° λ•λ¬Έμ— λ―Όκ°ν• μ •λ³΄ λ‹΄μ„ μ μ—†μ
- ν† ν°μ„ νƒμ·¨λ‹Ήν–μ„ μ‹μ λ€μ²κ°€ μ–΄λ ¤μ›€

μ°Έκ³  μλ£

[jwt.io](https://jwt.io/introduction)

[wikipedia](https://ko.wikipedia.org/wiki/JSON_%EC%9B%B9_%ED%86%A0%ED%81%B0#cite_note-rfc7519-1)

https://xxeol.tistory.com/34

[https://velog.io/@chuu1019/Access-Tokenκ³Ό-Refresh-Tokenμ΄λ€-λ¬΄μ—‡μ΄κ³ -μ™-ν•„μ”ν• κΉ](https://velog.io/@chuu1019/Access-Token%EA%B3%BC-Refresh-Token%EC%9D%B4%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B4%EA%B3%A0-%EC%99%9C-%ED%95%84%EC%9A%94%ED%95%A0%EA%B9%8C)

[https://velog.io/@gimminjae/JWTλ€-μ™-μ‚¬μ©ν• κΉ-μ¥λ‹¨μ μ€](https://velog.io/@gimminjae/JWT%EB%9E%80-%EC%99%9C-%EC%82%AC%EC%9A%A9%ED%95%A0%EA%B9%8C-%EC%9E%A5%EB%8B%A8%EC%A0%90%EC%9D%80)